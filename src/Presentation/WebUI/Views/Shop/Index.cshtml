@model PagedResponse<Product>
@{
    ViewData["Title"] = "Index";
}

<section class="hero hero-normal">
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                @await Component.InvokeAsync("AllCategories")
            </div>
            <div class="col-lg-9">
                <div class="hero__search">
                    <div class="hero__search__form">
                        <form action="#">
                            <div class="hero__search__categories">
                                All Categories
                                <span class="arrow_carrot-down"></span>
                            </div>
                            <input type="text" placeholder="What do yo u need?">
                            <button type="submit" class="site-btn">SEARCH</button>
                        </form>
                    </div>
                    <div class="hero__search__phone">
                        <div class="hero__search__phone__icon">
                            <i class="fa fa-phone"></i>
                        </div>
                        <div class="hero__search__phone__text">
                            <h5>+65 11.188.888</h5>
                            <span>support 24/7 time</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<section class="breadcrumb-section set-bg" data-setbg="/assets/img/breadcrumb.jpg">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <div class="breadcrumb__text">
                    <h2>Organi Shop</h2>
                    <div class="breadcrumb__option">
                        <a href="index-2.html">Home</a>
                        <span>Shop</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<section class="product spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-md-5">
                <div class="sidebar">
                    @await Component.InvokeAsync("AllCategories", new { view = "OnlyList" })
                    <div class="sidebar__item">
                        @* <h4>Price</h4> *@
                        <div class="border-default universal-padding mtb-40">
                            <div class="group-title">
                                <h2>price</h2>
                            </div>
                            <div id="price-range" data-min="20" data-max="100"></div>
                        </div>
@*                         <div class="price-range-wrap">
                            <div class="price-range ui-slider ui-corner-all ui-slider-horizontal ui-widget ui-widget-content" data-min="10" data-max="540">
                                <div class="ui-slider-range ui-corner-all ui-widget-header"></div>
                                <span tabindex="0" class="ui-slider-handle ui-corner-all ui-state-default"></span>
                                <span tabindex="0" class="ui-slider-handle ui-corner-all ui-state-default"></span>
                            </div>
                            <div class="range-slider">
                                <div class="price-input">
                                    <input type="text" id="minamount">
                                    <input type="text" id="maxamount">
                                </div>
                            </div>
                        </div> *@
                    </div>
                    <div class="sidebar__item sidebar__item__color--option">
                        @await Component.InvokeAsync("FilterColors")
                      @*   <h4>Colors</h4>

                        <div class="sidebar__item__color sidebar__item__color--white">
                            <label for="white">
                                White
                                <input type="radio" id="white">
                            </label>
                        </div>
                        <div class="sidebar__item__color sidebar__item__color--gray">
                            <label for="gray">
                                Gray
                                <input type="radio" id="gray">
                            </label>
                        </div>
                        <div class="sidebar__item__color sidebar__item__color--red">
                            <label for="red">
                                Red
                                <input type="radio" id="red">
                            </label>
                        </div>
                        <div class="sidebar__item__color sidebar__item__color--black">
                            <label for="black">
                                Black
                                <input type="radio" id="black">
                            </label>
                        </div>
                        <div class="sidebar__item__color sidebar__item__color--blue">
                            <label for="blue">
                                Blue
                                <input type="radio" id="blue">
                            </label>
                        </div>
                        <div class="sidebar__item__color sidebar__item__color--green">
                            <label for="green">
                                Green
                                <input type="radio" id="green">
                            </label>
                        </div> *@
                    </div>
                    <div class="sidebar__item">
                        <h4>Popular Size</h4>
                        <div class="sidebar__item__size">
                            <label for="large">
                                Large
                                <input type="radio" id="large">
                            </label>
                        </div>
                        <div class="sidebar__item__size">
                            <label for="medium">
                                Medium
                                <input type="radio" id="medium">
                            </label>
                        </div>
                        <div class="sidebar__item__size">
                            <label for="small">
                                Small
                                <input type="radio" id="small">
                            </label>
                        </div>
                        <div class="sidebar__item__size">
                            <label for="tiny">
                                Tiny
                                <input type="radio" id="tiny">
                            </label>
                        </div>
                    </div>
                    <div class="sidebar__item">
                        <div class="latest-product__text">
                            <h4>Latest Products</h4>
                            <div class="latest-product__slider owl-carousel">
                                <div class="latest-prdouct__slider__item">
                                    <a asp-action="Details" asp-route-id="1" class="latest-product__item">
                                        <div class="latest-product__item__pic">
                                            <img src="~/assets/img/latest-product/lp-1.jpg" alt="">
                                        </div>
                                        <div class="latest-product__item__text">
                                            <h6>Crab Pool Security</h6>
                                            <span>$30.00</span>
                                        </div>
                                    </a>
                                    <a asp-action="Details" asp-route-id="1" class="latest-product__item">
                                        <div class="latest-product__item__pic">
                                            <img src="~/assets/img/latest-product/lp-2.jpg" alt="">
                                        </div>
                                        <div class="latest-product__item__text">
                                            <h6>Crab Pool Security</h6>
                                            <span>$30.00</span>
                                        </div>
                                    </a>
                                    <a asp-action="Details" asp-route-id="1" class="latest-product__item">
                                        <div class="latest-product__item__pic">
                                            <img src="~/assets/img/latest-product/lp-3.jpg" alt="">
                                        </div>
                                        <div class="latest-product__item__text">
                                            <h6>Crab Pool Security</h6>
                                            <span>$30.00</span>
                                        </div>
                                    </a>
                                </div>
                                <div class="latest-prdouct__slider__item">
                                    <a asp-action="Details" asp-route-id="1" class="latest-product__item">
                                        <div class="latest-product__item__pic">
                                            <img src="~/assets/img/latest-product/lp-1.jpg" alt="">
                                        </div>
                                        <div class="latest-product__item__text">
                                            <h6>Crab Pool Security</h6>
                                            <span>$30.00</span>
                                        </div>
                                    </a>
                                    <a asp-action="Details" asp-route-id="1" class="latest-product__item">
                                        <div class="latest-product__item__pic">
                                            <img src="~/assets/img/latest-product/lp-2.jpg" alt="">
                                        </div>
                                        <div class="latest-product__item__text">
                                            <h6>Crab Pool Security</h6>
                                            <span>$30.00</span>
                                        </div>
                                    </a>
                                    <a asp-action="Details" asp-route-id="1" class="latest-product__item">
                                        <div class="latest-product__item__pic">
                                            <img src="~/assets/img/latest-product/lp-3.jpg" alt="">
                                        </div>
                                        <div class="latest-product__item__text">
                                            <h6>Crab Pool Security</h6>
                                            <span>$30.00</span>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-9 col-md-7">
                @await Component.InvokeAsync("SaleOffProducts")
                <div class="filter__item">
                    <div class="row">
                        <div class="col-lg-4 col-md-5">
                            <div class="filter__sort">
                                <span>Sıralamaq</span>
                                <select>
                                    <option value="0">Ada görə</option>
                                    <option value="0">Qiymətə görə</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4">
                            <div class="filter__found">
                                <h6><span>@Model.Count</span> məhsul tapıldı</h6>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-3">
                            <div class="filter__option">
                                <span class="icon_grid-2x2"></span>
                                <span class="icon_ul"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    @foreach (var product in Model.Items)
                    {
                        <div class="col-lg-4 col-md-6 col-sm-6">
                            <div class="product__item">
                                <div class="product__item__pic set-bg" data-setbg="@product.Path">
                                    <ul class="product__item__pic__hover">
                                        <li><a href="#"><i class="fa fa-heart"></i></a></li>
                                        <li><a href="#"><i class="fa fa-retweet"></i></a></li>
                                        <li><a href="#"><i class="fa fa-shopping-cart"></i></a></li>
                                    </ul>
                                </div>
                                <div class="product__item__text">
                                    <h6><a asp-action="details" asp-route-slug="@product.Slug">@product.Title</a></h6>
                                    <h5>@product.Price.ToString("0.00")</h5>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                @if (Model.Pages > 1)
                {
                    <pager asp-page="@Model.Page"
                           asp-size="@Model.Size"
                           asp-pages="@Model.Pages"
                           asp-has-next="@Model.HasNext"
                           asp-has-previous=@Model.HasPrevious />
                }
            </div>
        </div>
    </div>
</section>


@section addcss {
    <link rel="stylesheet" href="~/assets/css/pagination.css" type="text/css">
    <link href="~/lib/jquery-ui/jquery-ui.css" rel="stylesheet" />
    <style>
        [data-entity-type] {
            position: relative;
            padding-left: 30px;
            display: block;
            cursor: pointer;
        }

            [data-entity-type]:not(.filled)::before {
                content: "";
                font-size: 0.7em;
                font-weight: 900;
                font-family: "Font Awesome 5 Free";
                position: absolute;
                border: 1px solid #cccccc85;
                width: 18px;
                height: 18px;
                border-radius: 2px;
                top: 50%;
                left: 0px;
                transform: translateY(-50%);
                text-align: center;
                text-indent: 1px;
                line-height: 1.7em;
            }

            [data-entity-type].active:not(.filled)::before {
                content: "\f00c";
                color: #ffffff;
                background-color: #cccccc85;
                border-color: #cccccc85;
            }

            [data-entity-type].filled {
                width: 30px;
                height: 25px;
                border-radius: 2px;
                border: 1px solid #cccccc85;
            }

                [data-entity-type].filled::before {
                    content: "";
                    display: inline-block;
                    padding-left: 1px;
                    line-height: 7pt;
                    font-size: 5pt;
                    font-weight: 900;
                    font-family: "Font Awesome 5 Free";
                    position: absolute;
                    top: 1px;
                    right: 1px;
                }

                [data-entity-type].filled.active::before {
                    content: "\f00c";
                    color: #000000c4;
                    background-color: #ffffff;
                    border: 1px solid #000000c4;
                    width: 12px;
                    height: 12px;
                    border-radius: 100%;
                }

        #price-range[range]::before {
            content: attr(range);
            display: flex;
            justify-content: center;
            padding-top: 5px;
        }
</style>
}


@section addjs{
    <script src="~/lib/jquery-ui/jquery-ui.js"></script>
    <script>
        const filterObject = {
            page: 1,
            size: 9,
            colors: [],
            categories: [],
            price: {
                min: 0,
                max: 0
            }
        };

        $(document).ready(function () {

            let data = $("#price-range").data();

            data = {
                min: parseInt(data.min),
                max: parseInt(data.max)
            };

            $("#price-range")
                .attr('range', `${data.min}₼ - ${data.max}₼`)
                .slider({
                    range: true,
                    min: data.min,
                    max: data.max,
                    values: [data.min, data.max],
                    slide: function (e, ui) {
                        $(e.target).attr('range', `${ui.values[0]}₼ - ${ui.values[1]}₼`);
                        filterObject.price.min = parseInt(ui.values[0]);
                        filterObject.price.max = parseInt(ui.values[1]);

                        filterObject.page = 1;
                        search(filterObject);
                    }
                });

            $('a[data-entity-type]').click(function (e) {
                e.preventDefault();

                $(e.currentTarget).toggleClass('active');

                let dataObj = $(e.currentTarget).data();

                if ($(e.currentTarget).hasClass('active')) {
                    filterObject[dataObj.entityType].push(dataObj.id);
                }
                else {
                    filterObject[dataObj.entityType] = filterObject[dataObj.entityType]
                        .filter(item => item != dataObj.id)
                }

                filterObject.page = 1;
                search(filterObject);
            });

        });
        
                let pid;
        function search(searchObject){

                if(pid) 
                clearTimeout(pid);

                pid = setTimeout(function(){
                     console.log(filterObject);
                },500);
        }

    </script>
}